{% extends "base.html" %}

{% block title %}Students - Face Recognition Attendance{% endblock %}

{% block extra_css %}
<style>
    .search-container {
        position: relative;
        margin-bottom: 2rem;
    }

    .search-input {
        width: 100%;
        padding: 12px 16px 12px 50px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        background: rgba(255, 255, 255, 0.1);
        color: #ffffff;
        font-size: 1rem;
    }

    .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.6);
    }

    .student-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }

    .student-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        background: rgba(255, 255, 255, 0.15);
    }

    .student-photo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid rgba(255, 255, 255, 0.3);
    }

    .btn-sm {
        padding: 8px 16px;
        font-size: 0.9rem;
        margin: 0 4px;
    }
        /* Ensure dropdown text is visible */
        select, option {
            color: #222 !important;
            background: #fff !important;
        }
</style>
{% endblock %}

{% block content %}
<div style="padding: 2rem 0;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
        <h1 style="font-size: 2.5rem; background: linear-gradient(45deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            <i class="fas fa-users"></i> Students Management
        </h1>
        <a href="{{ url_for('add_student') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add New Student
        </a>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="searchInput" class="search-input" placeholder="Search students by name, ID, department...">
    </div>

    <!-- Students Grid -->
    <div id="studentsContainer">
        {% if students %}
            {% for student in students %}
            <div class="student-card" data-student-info="{{ student.name|lower }} {{ student.student_id|lower }} {{ student.department|lower }} {{ student.roll|lower }}">
                <div style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
                    <img src="{{ url_for('static', filename='uploads/' + student.photo) }}" 
                         alt="{{ student.name }}" 
                         class="student-photo"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iNDAiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSIyMCIgeT0iMjAiPgo8cGF0aCBkPSJNMTIgMTJDMTQuNzYxNCAxMiAxNyA5Ljc2MTQyIDE3IDdDMTcgNC4yMzg1OCAxNC43NjE0IDIgMTIgMkM5LjIzODU4IDIgNyA0LjIzODU4IDcgN0M3IDkuNzYxNDIgOS4yMzg1OCAxMiAxMiAxMloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xMiAxNEM4LjEzNDAxIDE0IDUgMTcuMTM0IDUgMjFIMTlDMTkgMTcuMTM0IDE1Ljg2NiAxNCAxMiAxNFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo8L3N2Zz4K'">
                    
                    <div style="flex: 1; min-width: 200px;">
                        <h3 style="margin-bottom: 0.5rem; color: #ffffff; font-size: 1.3rem;">{{ student.name }}</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; color: rgba(255, 255, 255, 0.8);">
                            <p><i class="fas fa-id-card"></i> ID: {{ student.student_id }}</p>
                            <p><i class="fas fa-hashtag"></i> Roll: {{ student.roll }}</p>
                            <p><i class="fas fa-building"></i> {{ student.department }}</p>
                            <p><i class="fas fa-graduation-cap"></i> {{ student.course }}</p>
                            <p><i class="fas fa-calendar"></i> Year {{ student.year }}</p>
                            <p><i class="fas fa-envelope"></i> {{ student.email }}</p>
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 0.5rem; min-width: 120px;">
                        <a href="{{ url_for('edit_student', student_id=student.id) }}" class="btn btn-secondary btn-sm">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <form method="POST" action="{{ url_for('delete_student', student_id=student.id) }}" 
                              onsubmit="return confirm('Are you sure you want to delete {{ student.name }}?')" style="margin: 0;">
                            <button type="submit" class="btn btn-danger btn-sm" style="width: 100%;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="card" style="text-align: center; padding: 3rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem; color: rgba(255, 255, 255, 0.3);">
                    <i class="fas fa-user-slash"></i>
                </div>
                <h3 style="margin-bottom: 1rem; color: rgba(255, 255, 255, 0.7);">No Students Found</h3>
                <p style="color: rgba(255, 255, 255, 0.5); margin-bottom: 2rem;">Get started by adding your first student to the system.</p>
                <a href="{{ url_for('add_student') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add First Student
                </a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Search functionality
    document.getElementById('searchInput').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const studentCards = document.querySelectorAll('.student-card');
        
        studentCards.forEach(card => {
            const studentInfo = card.getAttribute('data-student-info');
            if (studentInfo.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}
